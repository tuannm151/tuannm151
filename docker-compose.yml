version: '3'

services:
  user-service:
    image: ftvdexcz/user-service:0.0.2-SNAPSHOT
    ports:
      - 8000:8000
    networks:
      - gateway-network

    depends_on:
      - naming-service

    environment:
      - EUREKA.CLIENT.SERVICEURL.DEFAULTZONE=http://naming-service:8761/eureka
      - MANAGEMENT.ZIPKIN.TRACING.ENDPOINT=http://zipkin-server:9411/api/v2/spans
      # - SPRING.DATASOURCE.URL=jdbc:mysql://mysqldb:3306/garage_management_user_service
      # - SPRING.DATASOURCE.USERNAME=root
      - SPRING.DATASOURCE.URL=jdbc:mysql://pi.lan:3306/garage_management_user_service
      - SPRING.DATASOURCE.USERNAME=root
      - SPRING.DATASOURCE.PASSWORD=05120101
    restart: unless-stopped

  accessory-service:
    image: ftvdexcz/accessory-service:0.0.2-SNAPSHOT
    # mem_limit: 700m
    ports:
      - 8100:8100
    networks:
      - gateway-network
    depends_on:
      - naming-service
    environment:
      - EUREKA.CLIENT.SERVICEURL.DEFAULTZONE=http://naming-service:8761/eureka
      - MANAGEMENT.ZIPKIN.TRACING.ENDPOINT=http://zipkin-server:9411/api/v2/spans
      - SPRING.
      .URL=jdbc:mysql://pi.lan:3306/garage_management_accessory_service
      - SPRING.DATASOURCE.USERNAME=root
      - SPRING.DATASOURCE.PASSWORD=05120101
    restart: unless-stopped

  car-repair-service:
    image: ftvdexcz/car-repair-service:0.0.2-SNAPSHOT
    # mem_limit: 700m
    ports:
      - 8200:8200
    networks:
      - gateway-network
    depends_on:
      - naming-service
    environment:
      - EUREKA.CLIENT.SERVICEURL.DEFAULTZONE=http://naming-service:8761/eureka
      - MANAGEMENT.ZIPKIN.TRACING.ENDPOINT=http://zipkin-server:9411/api/v2/spans
      - SPRING.DATASOURCE.URL=jdbc:mysql://pi.lan:3306/garage_management_car_repair_service
      - SPRING.DATASOURCE.USERNAME=root
      - SPRING.DATASOURCE.PASSWORD=05120101
    restart: unless-stopped

  api-gateway:
    image: ftvdexcz/api-gateway:0.0.2-SNAPSHOT
    ports:
      - 8765:8765
    networks:
      - gateway-network
    depends_on:
      - naming-service
    environment:
      - EUREKA.CLIENT.SERVICEURL.DEFAULTZONE=http://naming-service:8761/eureka
      - MANAGEMENT.ZIPKIN.TRACING.ENDPOINT=http://zipkin-server:9411/api/v2/spans
    restart: unless-stopped

  naming-service:
    image: ftvdexcz/naming-service:0.0.2-SNAPSHOT
    ports:
      - 8761:8761
    networks:
      - gateway-network
    restart: unless-stopped

  # docker run -p 9411:9411 --name tracing-zipkin openzipkin/zipkin:2.23
  zipkin-server:
    image: openzipkin/zipkin:2.23
    ports:
      - 9411:9411
    networks:
      - gateway-network
networks:
  gateway-network:
